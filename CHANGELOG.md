# Changelog
All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

Changes are grouped as follows
- `Added` for new features.
- `Changed` for changes in existing functionality.
- `Deprecated` for soon-to-be removed features.
- `Removed` for now removed features.
- `Fixed` for any bug fixes.
- `Security` in case of vulnerabilities.


## Next release

## [2.1.0] - 2022-02-25

### Added
 
 * `uploader_extractor` and `uploader_types` modules used to create extractors
   writing to events, timeseries, or raw, by calling a common method.
   This is primarily used for the utils extensions, but can be useful for
   very simple extractors in general. 

### Fixed

 * Fixed a signature bug in `SequenceUploadQueue`'s `__enter__` method
   preventing it to be used as a context.


## [2.0.3] - 2022-02-08

### Fixed

 * Fixed an issue where the base class would not always load a default
   `LocalStateStore` if requested

## [2.0.2] - 2022-02-07

### Added

 * A `get_current_state_store` class method on the Extractor class which returns
   the most recent state store loaded


## [2.0.1] - 2022-02-01

### Fixed

 * Fixed retries to not block the GIL and respect the cancellation token
 
### Added

 * A `get_current_config` class method on the Extractor class which returns the
   most recent config file read


## [2.0.0] - 2022-01-24

### Added

 * Option to not handle `SIGINT`s gracefully
 * Configurable heartbeat interval

### Changed

 * Use `cognite-sdk-core` as base instead of `cognite-sdk`
 * Update Arrow to `>1.0.0`

### Migration guide

To update your projects to 2.0.0 there are two things to consider:

 * If you are specifying a version of the Cognite SDK to use in your dependency
   list, you must now specify `cognite-sdk-core` instead. Otherwise you might
   install both versions. E.g. If your `pyproject.toml` looks like this:

   ``` toml
   cognite-sdk = "^2.32.0"
   cognite-extractor-utils = "^1.3.3"
   ```

   You must also change the `cognite-sdk` dependency when updating
   `extractor-utils`:

   ``` toml
   cognite-sdk-core = "^2.32.0"
   cognite-extractor-utils = "^2.0.0"
   ```

 * If your extractor is using the included
   [`Arrow`](https://github.com/arrow-py/arrow) package, there are a few
   breaking changes (most notibly that the `timestamp` attribute is renamed to
   `int_timestamp`). Consult their [migration
   guide](https://github.com/arrow-py/arrow/issues/832) to make sure you are in
   compliance.


## [1.6.2] - 2022-01-22

### Changed

 * Allow environment variable substitution in bool type config fields without
   breaking generic environment variable substitution


## [1.6.1] - 2022-01-21

### Changed

 * Reverts 1.6.0 as it broke generic environment variable substitution


## [1.6.0] - 2022-01-21

### Fixed

 * Allow environment variable substitution in bool type config fields


## [1.5.4] - 2021-11-17

### Fixed

 *  Make Cognite SDK timeout configurable


## [1.5.3] - 2021-10-12

### Fixed

 * Add a base class for extractors to remove a lot of boilerplate code necesarry
   for startup/shutdown, initialization etc.


## [1.5.2] - 2021-09-27

### Fixed

 * Allow using `Enum`s in config classes


## [1.5.1] - 2021-09-24

### Added

 * An `ensure_assets` function similar to `ensure_timeseries`
 * A `BytesUploadQueue` that takes byte arrays directly instead of file paths
 * A `throttled_loop` generator that iterates at most every `n` seconds
 * An `EitherIdConfig` to configure e.g. data sets with either an id or external
   id in the same field.

### Changed

 * Never call `/login/status` as the endpoint is deprecated

### Fixed

 * Inlcude missing classes and modules in docs

### Deprecated

 * Using `dataset-id` or `dataset-external-id` fields, use the new
   `EitherIdConfig` instead.


## [1.5.0] - 2021-08-12

### Added

 * Add a base class for extractors to remove a lot of boilerplate code necesarry
   for startup/shutdown, initialization etc.


## [1.4.2] - 2021-06-01

### Fixed

 * Fix an issue in `SequenceUploadQueue.add_to_upload_queue` when adding
   multiple rows to the same id


## [1.4.1] - 2021-05-03

### Changed

 * Changed bucket sizes for observed times in uploader metrics to be more suited
   for expected values.


## [1.4.0] - 2021-04-13

### Added

 * Option to provide additional custum args to token fetching (via the
   `token_custom_args` arg to the `CogniteClient` constructor)


### Changed

 * Use token fetching from Cognite SDK instead of our own implementation


### Deprecated

 * `Authenticator` class


## [1.3.4] - 2021-03-31

### Added

 * Add config parameter to enable metrics of log messages. It reveals how many
   logging events happened per logger and log-level.


## [1.3.3] - 2021-03-30

### Changed

 * Reduce cardinality (by reducing label count) on autogenerated metrics. E.g.
   don't label `TIMESERIES_UPLOADER_POINTS_WRITTEN` with which time series it's
   writing to.


## [1.3.2] - 2021-03-29

### Added

 * Add option to specify external IDs for data sets


## [1.3.1] - 2021-03-22

### Fixed

 * Fix labels for generated Prometheus


## [1.3.0] - 2021-03-15

### Fixed

 * Add a cancellation token to all data uploaders and metrics pushers
 * Add various automatic Prometheus metrics for data uploaders


## [1.2.4] - 2021-03-02

### Fixed

 * Fix URL creation in OAuth flow


## [1.2.3] - 2021-01-07

### Fixed

 * Fix a pool issue in FileUploadQueue


## [1.2.2] - 2020-12-07

### Added

 * General OIDC token support


## [1.2.1] - 2020-10-20

### Added

 * Add option to authenticate to CDF with AAD


## [1.2.0] - 2020-09-16

### Added

 * Add upload queues for sequences and files

### Fixed

 * TimeSeriesUploadQueue can now auto-create string time series


## [1.1.1] - 2020-08-27

### Added

 * Add option to create missing time series from upload queue

### Fix

 * Fixed an issue in EitherId where the `repr` method didn't return a string (as
   would be expected).


## [1.1.0] - 2020-08-25

### Added

 * Add py.typed file so mypy knows that package is typed


## [1.0.2] - 2020-06-02

### Fixed

 * Don't require auth for prometheus push gateways as push gateways can be
   configured to allow unauthorized access.
 * Fixed a bug where the state store config would not allow raw state stores
   without explicit `null` on local


## [1.0.1] - 2020-05-25

### Added

 * An outside_state method to test if a new proposed state in state stores is
   covered or not
 * A general SIGINT handler
 * Several minor additions to configtools: Defaults in StateStoreConfig,
   optional dataset ID in CogniteConfig, option to have version as int or None
 * Add a metrics factory that caches instances

### Fixed

 * A concurrency issue with TimeSeriesUploadQueue where uploads could fail if
   points were added at the very start of the upload call
 * Fix documentation build


## [1.0.0] - 2020-05-15

Release the first stable version. Open source the library under the Apache 2.0
license
